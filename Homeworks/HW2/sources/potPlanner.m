%  This file is an example template you can use for your solution.  It
% provides wrapper functions as well as various utilities that may be
% useful for your implementation
%
%  Your solution can implement the following function
%
%   [x,y] = bug_planner( qstart, qgoal )
%
% This function is expected to return a collision free path
% starting from qstart and ending in qgoal, both supplied as row
% vectors. The returned values should be row vectors with the x and
% y coordinates of the robot along this path, as it would have
% followed with your planner in effect.
%
% In implementing these functions, you are only allowed to use the
% following functions supplied with the homework (as well as any
% others you may choose to implement yourself):
%
%  draw_arena, draw_range_map, read_sensor
%
%  Furthermore, you are only allowed to access the following global
% variables:
%
%  sensor_range, infinity
%
%  You may of course write your own functions as you see fit as long
% as you do not cheat by accessing the global arena map and follow
% submission guidelines for this homework. You may also use various
% builtin Matlab functions as you see fit.
%
%  Please follow good coding standards and document your code with
% useful and clear comments in English.
%
% All quantities are in MKS units unless otherwise specified.
%  distances    : m
%  angles       : rad
%  speed        : m/s
%  acceleration : m/s^2
%
function potPlanner 
%clear
clc
% Global Parameters Declarations -----------------
global sensor_range;  % Determines limited sensor range
global arena_limits;  % Boundaries of the arena: [xmin xmax ymin ymax]
global arena_map;     % Description of obstacles in the environment
global approx_map;    % Approximate map of obstacles
global infinity;      % Large value to be used as 'infinity'
global qstart qgoal;  % Start and goal configurations
global epsilon;       % Threshold for the goal region
global solver;        % "DISCRETE" or "ODE"
global obst_approx;   % "EXACT" or "APPROX"
global dimension;     % Dimension of the arena


% Parameters
epsilon = 0.1; % Threshold for the goal region

% Parameter values to be used for the homework ---
sensor_range = 100;
infinity = 1e5;
arena_limits = [0 10 0 10];
qstart = [ 0.5 0.5 0.5 0.5 ];
qgoal = [9 9 9 9];
dimension = length(qstart);
solver = "DISCRETE"; % "DISCRETE" or "ODE"
obst_approx = "APPROX"; % "EXACT" or "APPROX"

% Invoking your solutions for the example arena ------------------------
% init_arena();
errorCheck();

if obst_approx == "APPROX"
    approx_map = approxObst(arena_map);
end
% tic
% toc

% call potential function with ode
tic
if solver == "ODE"
    tspan = [1 1e25];
    options = odeset('Event',@(t,qstart) gradEventFunc(t,qstart,qgoal));
    [T,Y] = ode45(@(t,qstart) gradFunction(t,qstart,qgoal),tspan,qstart,options);

elseif solver == "DISCRETE"
    [Y] = qstart;
    for step = 1:1000
        Y(step+1,:) = Y(step,:)' + 0.01*gradFunction(0,Y(step,:)',qgoal);
    end
end
toc

Y;
% figure(2);
% clf;
% for i = 1:length(x_m1_b1)/n
%   draw_range_map( [x_m1_b1(n*i) y_m1_b1(n*i)], 30 );
%   drawnow;
% end


plotPath(Y);
plotPotential();



end



% init_arena -----------------------------------------------------------------
function init_arena
global arena_map qstart qgoal;

arena_map = [];
% arena_map{1} = ...
% [ 2.0392  3.5234; 1.8318  5.0731; 2.0161  6.7982; 2.6152  8.1433; ...
%   3.5369  8.9035; 5.0576  9.0205; 6.3249  8.8158; 7.4078  7.8509; ...
%   8.0300  6.8275; 8.1452  4.8977; 8.0760  3.4357; 7.6613  2.1784; ...
%   6.8548  1.1842; 5.3571  0.8041; 4.3433  1.0965; 3.6751  2.5000; ...
%   3.5369  3.7281; 3.4447  4.8099; 3.9977  6.2135; 4.5968  6.7982; ...
%   5.0115  6.5936; 4.5968  5.6287; 4.1820  4.6930; 4.0668  3.7865; ...
%   4.1129  2.5877; 4.5276  1.7398; 5.4954  1.3596; 6.6705  1.6228; ...
%   7.2465  2.4415; 7.6843  3.6696; 7.7765  5.1608; 7.6843  6.3304; ...
%   6.9700  7.3246; 6.1866  8.1140; 5.0346  8.3480; 3.7673  8.2018; ...
%   3.1682  7.7924; 2.4539  6.7105; 2.3848  5.1023];


% arena_map{1} = ...
% [ 5.2889  5.1131; 4.7111  4.2839; 4.8869  3.5302; ...
%   6.1683  3.9070; 6.1432  5.0377 ];
%   
% arena_map{2} = ...
% [ 5.1382    7.2487; 5.3392  6.8719; 5.3392  6.3693; ...
%     5.2889  6.0427; 5.5402  6.0930; 5.7412  6.4447; ...
%     5.7412  6.9724; 5.4899  7.2990; 5.2638  7.4749 ];


% arena_map{2} =  ...
%    [    8 1  4 ;   ...
%         1  0.2 4 ;   ...
%         1 0.8 3 ;   ...
%         8   4 3.5];

% arena_map{1} =   ...
%    [    4    1   ;    ...
%         4    1   ;    ...
%         2    2.3  ;    ...
%         2    3   ;    ...
%         2.5  5   ;  ...
%         2.5  2.2  ];

alphh= 7*rand(1);
arena_map{1} =  ...
   [    (5+alphh*rand(1))  (5+alphh*rand(1))   (5+alphh*rand(1))  (5+alphh*rand(1))  ;    ...
        (5+alphh*rand(1))  (5+alphh*rand(1))   (5+alphh*rand(1))  (5+alphh*rand(1))  ;    ...
        (5+alphh*rand(1))  (5+alphh*rand(1))   (5+alphh*rand(1))  (5+alphh*rand(1))  ;    ...
        (5+alphh*rand(1))  (5+alphh*rand(1))   (5+alphh*rand(1))  (5+alphh*rand(1))  ;    ...
        (5+alphh*rand(1))  (5+alphh*rand(1))   (5+alphh*rand(1))  (5+alphh*rand(1))  ;    ...
        (5+alphh*rand(1))  (5+alphh*rand(1))   (5+alphh*rand(1))  (5+alphh*rand(1))  ];

gena =8*rand(1);
genb =8*rand(1);
genc =8*rand(1);

gend =8*rand(1);
gene =8*rand(1);
genf =8*rand(1);

gent =8*rand(1);
geny =8*rand(1);
genu =8*rand(1);

arena_map{2} =  ...   
   [    (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ;    ...
        (gena+alphh*rand(1))  (genb+alphh*rand(1))   (genc+alphh*rand(1)) (genf+alphh*rand(1))   ];

arena_map{3} =  ...   
   [    (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ;    ...
        (gend+alphh*rand(1))  (gene+alphh*rand(1))   (genf+alphh*rand(1))  (gent+alphh*rand(1))  ];

arena_map{4} =  ...   
   [    (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ;    ...
        (gent+alphh*rand(1)) (genu+genb*rand(1))  (geny+alphh*rand(1))   (genu+alphh*rand(1))   ];
    
arena_map{5} =  ...   
    [   (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ;    ...
        (gent+gent*rand(1))  (gend+gena*rand(1))   (genu+genb*rand(1))  (geny+alphh*rand(1))   ];
        

% arena_map{1} = ...
%    [4.0233    7.0408 ; ...
%     4.4023    7.2741 ; ...
%     4.8688    7.3615 ; ...
%     5.3061    7.3615 ; ...
%     5.7143    7.2741 ; ...
%     6.2391    7.0700 ; ...
%     6.3557    7.4781 ; ...
%     6.3265    7.7988 ; ...
%     5.6851    8.0321 ; ...
%     4.8397    8.0029 ; ...
%     4.2566    7.8280 ; ...
%     3.7318    7.5073 ; ...
%     3.8192    7.0991] ;
% 
% arena_map{2} = ...
%    [3.5277    1.7347 ; ...
%     3.9067    1.7347 ; ...
%     4.1691    2.0554 ; ...
%     3.9942    2.5510 ; ...
%     3.6443    2.9300 ; ...
%     3.5860    3.2507 ; ...
%     3.8192    3.6006 ; ...
%     4.2274    3.8921 ; ...
%     4.5481    3.9504 ; ...
%     5.2187    4.2711 ; ...
%     5.5685    4.4169 ; ...
%     6.0933    4.7668 ; ...
%     6.0933    5.2041 ; ...
%     5.5977    5.4082 ; ...
%     4.8980    5.6706 ; ...
%     4.0816    5.6706 ; ...
%     3.3528    5.4373 ; ...
%     3.3819    4.7376 ; ...
%     3.0321    4.0671 ; ...
%     2.2741    3.8921 ; ...
%     1.6618    3.8047 ; ...
%     1.3994    3.0175 ; ...
%     1.4869    2.0845];

end
